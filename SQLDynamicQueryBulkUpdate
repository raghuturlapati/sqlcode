/* SQL Server Bulk Convert from One DataType to another under a schema */
--Dynamic Query


DECLARE @TBL_NAME VARCHAR(50)
DECLARE @TBL_SCHEMA VARCHAR(50)
DECLARE @COL1EXISTS INT
DECLARE @COL2EXISTS INT
DECLARE @COL3EXISTS INT
DECLARE @COL1NAME VARCHAR(50)
DECLARE @COL2NAME VARCHAR(50)
DECLARE @COL3NAME VARCHAR(50)
DECLARE @SQLOUT VARCHAR(MAX)


SET @TBL_NAME = ''
SET @TBL_SCHEMA = 'YOURSCHEMA'
SET @COL1EXISTS = 0
SET @COL2EXISTS = 0
SET @COL3EXISTS = 0
SET @COL1NAME = 'COL1'
SET @COL2NAME = 'COL2'
SET @COL3NAME = 'COL3'

SET @SQLOUT= ''

DECLARE CUR CURSOR FOR

SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
			WHERE TABLE_SCHEMA = @TBL_SCHEMA


OPEN CUR
FETCH NEXT FROM CUR INTO @TBL_NAME

WHILE @@FETCH_STATUS = 0
BEGIN


SELECT @COL1EXISTS = COUNT(*) FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = @TBL_NAME AND TABLE_SCHEMA = @TBL_SCHEMA AND COLUMN_NAME = @COL1NAME

SELECT @COL2EXISTS = COUNT(*) FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = @TBL_NAME AND TABLE_SCHEMA = @TBL_SCHEMA AND COLUMN_NAME = @COL2NAME

SELECT @COL3EXISTS = COUNT(*) FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = @TBL_NAME AND TABLE_SCHEMA = @TBL_SCHEMA AND COLUMN_NAME = @COL3NAME


IF @COL1EXISTS = 1 AND @COL2EXISTS = 1 

BEGIN
PRINT 'CURRENTLY UPDATING TABLE '+@TBL_NAME+' ...'
SET @SQLOUT = 'UPDATE '+@TBL_SCHEMA+'.'+@TBL_NAME+' SET '+@COL1NAME+' = CONVERT(DATETIME,'+@COL2NAME+',100)'
PRINT @SQLOUT
EXEC(@SQLOUT)


END


FETCH NEXT FROM CUR INTO @TBL_NAME


END


CLOSE CUR
DEALLOCATE CUR
